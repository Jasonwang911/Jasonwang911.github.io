(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{598:function(s,a,t){s.exports=t.p+"assets/img/cicd.e1916119.png"},616:function(s,a,t){"use strict";t.r(a);var e=t(6),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"title"},[s._v("使用 Github Actions 部署应用到云服务器")]),e("p",[s._v("使用GitHub Actions 将自己静态网站（vuepress）部署到云服务器，原理如下"),e("br"),s._v(" "),e("img",{attrs:{src:t(598),width:"600",height:"500",alt:"github actions",align:"center"}})])]),e("Boxx",{attrs:{type:"warning",changeTime:"30000"}}),s._v(" "),e("h2",{attrs:{id:"一、准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、准备工作"}},[s._v("#")]),s._v(" 一、准备工作")]),s._v(" "),e("h3",{attrs:{id:"_1-创建work账号"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建work账号"}},[s._v("#")]),s._v(" 1. 创建work账号")]),s._v(" "),e("ul",[e("li",[s._v("处于安全考虑，日常不会使用root账号登录，权限太高了")])]),s._v(" "),e("ol",[e("li",[s._v("用root登录，创建work账号"),e("br"),s._v("\nLinux 系统中用户相关学习请移步  "),e("a",{attrs:{href:"/linux/users"}},[s._v("Linux 用户（user）用户组（group）")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("adduser work\npasswd work\n\nwhoami # 查看当前登录用户名\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("添加work的sudo权限")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("whereis sudoers # 找到文件位置  /etc/sudoers   \n\nchmod  u+w /etc/sudoers  # 修改权限 u 标识所有者 w 表示写权限  + 表示添加\n\nvim /etc/sudoers  # 编辑该文件\n# 找到      `root ALL=(ALL)   ALL`\n# 添加一行   `work ALL=(ALL)   ALL`\n\nchmod u-w /etc/sudoers   # 还原权限\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("使用work登录机器，输入su，再输入root账号的密码，即可拥有超级权限。")]),s._v(" "),e("h3",{attrs:{id:"_2-登录信任"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-登录信任"}},[s._v("#")]),s._v(" 2. 登录信任")]),s._v(" "),e("p",[s._v("ssh免登陆的原理是这样的，A将自己的公钥发送给B，A要登陆B，B给A发送一个随机数，然后A用自己的私钥对这个随机数加密，B用保存的A的公钥解密，如果得到的随机数和之前发送的一样，则验证通过。")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("方法1")]),s._v("\n为了避免每次登录输入密码，需要进行登录信任，创建 "),e("code",[s._v("~/.ssh/authorized_keys")]),s._v(" 文件")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 修改文件夹权限\nchmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("将本机的 "),e("code",[s._v("id_rsa.pub")]),s._v(" 内容粘贴进来")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("方法2")]),e("br"),s._v("\n在本地执行 "),e("code",[s._v("ssh-copy-id")]),s._v(" 命令将公钥文件传输的远程机器，并生效")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 本机如果没有.ssh文件，需要先生成  \n# ssh-keygen -t rsa -C "xx@qq.com"(随便编个字符串，一般用邮箱）\nssh-copy-id -i ~/.ssh/id_rsa.pub work@xx.xx.xx.xx\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("以上两种方法人选其一退出重新用work登录，将不用再输入密码")]),s._v(" "),e("h3",{attrs:{id:"_3-安装必备软件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装必备软件"}},[s._v("#")]),s._v(" 3. 安装必备软件")]),s._v(" "),e("ul",[e("li",[s._v("Git")]),s._v(" "),e("li",[s._v("docker\n"),e("ul",[e("li",[s._v("安装docker")]),s._v(" "),e("li",[s._v("docker 镜像加速")]),s._v(" "),e("li",[s._v("安装docker-compose")])])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker version\ndocker-compose --version\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_4-开放端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-开放端口"}},[s._v("#")]),s._v(" 4. 开放端口")]),s._v(" "),e("ul",[e("li",[s._v("开放需要的端口，否则外网无法访问该端口")]),s._v(" "),e("li",[s._v("线上环境，只会开放nginx端口，使用nginx反向代理")])]),s._v(" "),e("h2",{attrs:{id:"二、部署应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、部署应用"}},[s._v("#")]),s._v(" 二、部署应用")]),s._v(" "),e("h3",{attrs:{id:"_1-思路梳理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-思路梳理"}},[s._v("#")]),s._v(" 1. 思路梳理")]),s._v(" "),e("ul",[e("li",[s._v("使用GitHub Actions监听master分支push")]),s._v(" "),e("li",[s._v("云服务器获取master分支最新代码")]),s._v(" "),e("li",[s._v("构建docker-compose")]),s._v(" "),e("li",[s._v("重启容器")])]),s._v(" "),e("h3",{attrs:{id:"_2-配置deplay-linux-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置deplay-linux-yml"}},[s._v("#")]),s._v(" 2. 配置deplay-linux.yml")]),s._v(" "),e("ul",[e("li",[s._v("讲本地的id_rsa内容添加到github仓库的中的secrets")]),s._v(" "),e("li",[s._v("windows 复制id_rsa到github仓库的中的secrets经过传递会出现报错")]),s._v(" "),e("li",[s._v("使用 "),e("code",[s._v("easingthemes/ssh-deploy@main")]),s._v(" actions")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('Load key "/home/runner/.ssh/id_rsa": invalid format\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("Vssue",{attrs:{title:"Github Actions 发布到云服务器"}})],1)}),[],!1,null,null,null);a.default=r.exports}}]);